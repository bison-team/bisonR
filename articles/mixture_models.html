<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Edge mixture models • bisonR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Edge mixture models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bisonR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>bisonR</h6></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/bison_brms.html">Using brms with BISoN</a></li>
    <li><a class="dropdown-item" href="../articles/mixture_models.html">Edge mixture models</a></li>
    <li><a class="dropdown-item" href="../articles/network_metrics.html">Network metrics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Help</h6></li>
    <li><a class="dropdown-item" href="../articles/windows_installation.html">Installing cmdstanR on Windows</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Edge mixture models</h1>
            
      

      <div class="d-none name"><code>mixture_models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Edge mixture models can be used to detect different types of social
connections by looking for clustering in edge weights. bisonR provides
support for edge mixture models with the <code>bison_mixture</code>
function. There are two key outputs from a bisonR edge mixture model.
First it generates a posterior probability distribution over the number
of components (clusters, interpreted associal connection types), from 1
to a maximum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>,
over the entire network. Secondly, for each edge it calculates the
probability that each dyad belongs to each possible component. To show
how this all works, first we’ll load in bisonR and simulate some
data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bisonr.org" class="external-link">bisonR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: cmdstanr</span></span>
<span><span class="co">#&gt; This is cmdstanr version 0.9.0</span></span>
<span><span class="co">#&gt; - CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</span></span>
<span><span class="co">#&gt; - CmdStan path: /home/runner/.cmdstan/cmdstan-2.36.0</span></span>
<span><span class="co">#&gt; - CmdStan version: 2.36.0</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'igraph'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     as_data_frame, groups, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     decompose, spectrum</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Rcpp</span></span>
<span><span class="co">#&gt; Loading 'brms' package (version 2.22.0). Useful instructions</span></span>
<span><span class="co">#&gt; can be found by typing help('brms'). A more detailed introduction</span></span>
<span><span class="co">#&gt; to the package is available through vignette('brms_overview').</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'brms'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ar</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/" class="external-link">mclust</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Package 'mclust' version 6.1.1</span></span>
<span><span class="co">#&gt; Type 'citation("mclust")' for citing this R package in publications.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'mclust'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:brms':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     me</span></span></code></pre></div>
<p>In this example we simulate data from a binary edge model with 2
underlying clusters (also called components), with dyads belong to
either cluster with equal probability:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_bison_model_mixture.html">simulate_bison_model_mixture</a></span><span class="op">(</span><span class="st">"binary"</span>, num_components <span class="op">=</span> <span class="fl">2</span>, component_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">df_sim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   node_1_id [1]</span></span></span>
<span><span class="co">#&gt;   node_1_id node_2_id event duration age_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1         2            10       11        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1         3             0        1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1         4            13       13        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1         5            10       10        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1         6             3       12        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1         7            14       16        1</span></span></code></pre></div>
<p>Since the data are already aggregated (e.g. a single row for each
dyad), we can use the binary conjugate model for speed:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_edge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bison_model.html">bison_model</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">event</span> <span class="op">|</span> <span class="va">duration</span><span class="op">)</span> <span class="op">~</span> <span class="fu">dyad</span><span class="op">(</span><span class="va">node_1_id</span>, <span class="va">node_2_id</span><span class="op">)</span>, </span>
<span>  data<span class="op">=</span><span class="va">df</span>, </span>
<span>  model_type<span class="op">=</span><span class="st">"binary_conjugate"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No priors set by user, using default priors instead. We recommend setting and checking priors explicitly for reliable inference.</span></span></code></pre></div>
<p>We won’t conduct the usual checks for the sake of this tutorial, but
at this point we’d recommend conducting diagnostic checks to ensure
model fit. Once the model has fit well, we can use the
<code><a href="../reference/bison_mixture.html">bison_mixture()</a></code> function to fit the edge mixture model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># verbose=FALSE for tutorial purposes</span></span>
<span><span class="va">fit_mixture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bison_mixture.html">bison_mixture</a></span><span class="op">(</span><span class="va">fit_edge</span>, num_components<span class="op">=</span><span class="fl">5</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_mixture</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Fitted dyadic mixture model ===</span></span>
<span><span class="co">#&gt; Maximum number of components: </span></span>
<span><span class="co">#&gt; Best model: 1 components</span></span>
<span><span class="co">#&gt; Probability of best model: 73.5%</span></span>
<span><span class="co">#&gt; === Component probabilities ===</span></span>
<span><span class="co">#&gt;            1     2     3     4 5</span></span>
<span><span class="co">#&gt; P(K=k) 0.735 0.231 0.019 0.015 0</span></span>
<span><span class="co">#&gt; === Component means for best model (K = 1) ===</span></span>
<span><span class="co">#&gt;              1</span></span>
<span><span class="co">#&gt; mean 0.5471098</span></span>
<span><span class="co">#&gt; === Edge component probabilities for best model (K = 1) ===</span></span>
<span><span class="co">#&gt;         1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 2 1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 3 1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 4 1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 5 1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 6 1</span></span>
<span><span class="co">#&gt; 1 &lt;-&gt; 7 1</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
<p>There’s quite a bit going on in the summary, so let’s break it down.
The top section shows the model that fits best and the probability
assigned to that model. The second section shows the probabilities of
the models corresponding to each number of components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">K = 1, 2, 3, ...</annotation></semantics></math>).
You’ll notice the model with the highest probability is the same as the
best fitting model from the section above. The final section shows the
edge-level probabilities of component membership for the corresponding
dyad. This can be interpreted as the probability a dyad belongs to a
given component/cluster/social connection type.</p>
<p>The information shown in the summary above can also be accessed using
the functions <code><a href="../reference/get_network_component_probabilities.html">get_network_component_probabilities()</a></code> and
<code><a href="../reference/get_edge_component_probabilities.html">get_edge_component_probabilities()</a></code>. These two functions
make it possible to access the mixture model output programmatically for
downstream analysis or plotting.</p>
<p>To get network-level probabilities of the number of components, we
can use <code><a href="../reference/get_network_component_probabilities.html">get_network_component_probabilities()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_network_component_probabilities.html">get_network_component_probabilities</a></span><span class="op">(</span><span class="va">fit_mixture</span><span class="op">)</span></span>
<span><span class="co">#&gt;   num_components  probability</span></span>
<span><span class="co">#&gt; 1              1 0.7345254805</span></span>
<span><span class="co">#&gt; 2              2 0.2312023503</span></span>
<span><span class="co">#&gt; 3              3 0.0188747949</span></span>
<span><span class="co">#&gt; 4              4 0.0152140086</span></span>
<span><span class="co">#&gt; 5              5 0.0001833657</span></span></code></pre></div>
<p>To use probabilities over component membership for a given number of
components, we can use the
<code><a href="../reference/get_edge_component_probabilities.html">get_edge_component_probabilities()</a></code> function, where
<code>3</code> is the number of components we assume to exist in the
network:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_edge_component_probabilities.html">get_edge_component_probabilities</a></span><span class="op">(</span><span class="va">fit_mixture</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     node_1 node_2 P(K = 1) P(K = 2) P(K = 3)</span></span>
<span><span class="co">#&gt; 1        1      2    0.015    0.425    0.560</span></span>
<span><span class="co">#&gt; 2        1      3    0.605    0.260    0.135</span></span>
<span><span class="co">#&gt; 3        1      4    0.000    0.310    0.690</span></span>
<span><span class="co">#&gt; 4        1      5    0.000    0.340    0.660</span></span>
<span><span class="co">#&gt; 5        1      6    0.790    0.155    0.055</span></span>
<span><span class="co">#&gt; 6        1      7    0.030    0.460    0.510</span></span>
<span><span class="co">#&gt; 7        1      8    0.935    0.060    0.005</span></span>
<span><span class="co">#&gt; 8        1      9    0.925    0.075    0.000</span></span>
<span><span class="co">#&gt; 9        1     10    0.925    0.070    0.005</span></span>
<span><span class="co">#&gt; 10       1     11    0.850    0.125    0.025</span></span>
<span><span class="co">#&gt; 11       1     12    0.895    0.095    0.010</span></span>
<span><span class="co">#&gt; 12       1     13    0.960    0.040    0.000</span></span>
<span><span class="co">#&gt; 13       1     14    0.650    0.250    0.100</span></span>
<span><span class="co">#&gt; 14       1     15    0.005    0.270    0.725</span></span>
<span><span class="co">#&gt; 15       2      3    0.860    0.115    0.025</span></span>
<span><span class="co">#&gt; 16       2      4    0.015    0.455    0.530</span></span>
<span><span class="co">#&gt; 17       2      5    0.085    0.430    0.485</span></span>
<span><span class="co">#&gt; 18       2      6    0.035    0.355    0.610</span></span>
<span><span class="co">#&gt; 19       2      7    0.000    0.385    0.615</span></span>
<span><span class="co">#&gt; 20       2      8    0.935    0.055    0.010</span></span>
<span><span class="co">#&gt; 21       2      9    0.795    0.190    0.015</span></span>
<span><span class="co">#&gt; 22       2     10    0.930    0.070    0.000</span></span>
<span><span class="co">#&gt; 23       2     11    0.925    0.075    0.000</span></span>
<span><span class="co">#&gt; 24       2     12    0.010    0.450    0.540</span></span>
<span><span class="co">#&gt; 25       2     13    0.920    0.075    0.005</span></span>
<span><span class="co">#&gt; 26       2     14    0.090    0.410    0.500</span></span>
<span><span class="co">#&gt; 27       2     15    0.935    0.055    0.010</span></span>
<span><span class="co">#&gt; 28       3      4    0.170    0.450    0.380</span></span>
<span><span class="co">#&gt; 29       3      5    0.915    0.080    0.005</span></span>
<span><span class="co">#&gt; 30       3      6    0.005    0.490    0.505</span></span>
<span><span class="co">#&gt; 31       3      7    0.000    0.420    0.580</span></span>
<span><span class="co">#&gt; 32       3      8    0.000    0.375    0.625</span></span>
<span><span class="co">#&gt; 33       3      9    0.230    0.430    0.340</span></span>
<span><span class="co">#&gt; 34       3     10    0.000    0.395    0.605</span></span>
<span><span class="co">#&gt; 35       3     11    0.835    0.135    0.030</span></span>
<span><span class="co">#&gt; 36       3     12    0.930    0.060    0.010</span></span>
<span><span class="co">#&gt; 37       3     13    0.940    0.055    0.005</span></span>
<span><span class="co">#&gt; 38       3     14    0.910    0.085    0.005</span></span>
<span><span class="co">#&gt; 39       3     15    0.940    0.060    0.000</span></span>
<span><span class="co">#&gt; 40       4      5    0.625    0.220    0.155</span></span>
<span><span class="co">#&gt; 41       4      6    0.035    0.405    0.560</span></span>
<span><span class="co">#&gt; 42       4      7    0.015    0.420    0.565</span></span>
<span><span class="co">#&gt; 43       4      8    0.935    0.060    0.005</span></span>
<span><span class="co">#&gt; 44       4      9    0.000    0.310    0.690</span></span>
<span><span class="co">#&gt; 45       4     10    0.005    0.405    0.590</span></span>
<span><span class="co">#&gt; 46       4     11    0.935    0.065    0.000</span></span>
<span><span class="co">#&gt; 47       4     12    0.245    0.455    0.300</span></span>
<span><span class="co">#&gt; 48       4     13    0.030    0.425    0.545</span></span>
<span><span class="co">#&gt; 49       4     14    0.940    0.055    0.005</span></span>
<span><span class="co">#&gt; 50       4     15    0.945    0.050    0.005</span></span>
<span><span class="co">#&gt; 51       5      6    0.085    0.415    0.500</span></span>
<span><span class="co">#&gt; 52       5      7    0.910    0.080    0.010</span></span>
<span><span class="co">#&gt; 53       5      8    0.660    0.255    0.085</span></span>
<span><span class="co">#&gt; 54       5      9    0.000    0.300    0.700</span></span>
<span><span class="co">#&gt; 55       5     10    0.925    0.070    0.005</span></span>
<span><span class="co">#&gt; 56       5     11    0.020    0.450    0.530</span></span>
<span><span class="co">#&gt; 57       5     12    0.005    0.380    0.615</span></span>
<span><span class="co">#&gt; 58       5     13    0.000    0.370    0.630</span></span>
<span><span class="co">#&gt; 59       5     14    0.005    0.405    0.590</span></span>
<span><span class="co">#&gt; 60       5     15    0.015    0.510    0.475</span></span>
<span><span class="co">#&gt; 61       6      7    0.000    0.350    0.650</span></span>
<span><span class="co">#&gt; 62       6      8    0.010    0.370    0.620</span></span>
<span><span class="co">#&gt; 63       6      9    0.670    0.245    0.085</span></span>
<span><span class="co">#&gt; 64       6     10    0.065    0.485    0.450</span></span>
<span><span class="co">#&gt; 65       6     11    0.090    0.440    0.470</span></span>
<span><span class="co">#&gt; 66       6     12    0.620    0.295    0.085</span></span>
<span><span class="co">#&gt; 67       6     13    0.000    0.300    0.700</span></span>
<span><span class="co">#&gt; 68       6     14    0.080    0.410    0.510</span></span>
<span><span class="co">#&gt; 69       6     15    0.945    0.045    0.010</span></span>
<span><span class="co">#&gt; 70       7      8    0.940    0.055    0.005</span></span>
<span><span class="co">#&gt; 71       7      9    0.000    0.435    0.565</span></span>
<span><span class="co">#&gt; 72       7     10    0.940    0.050    0.010</span></span>
<span><span class="co">#&gt; 73       7     11    0.025    0.475    0.500</span></span>
<span><span class="co">#&gt; 74       7     12    0.000    0.380    0.620</span></span>
<span><span class="co">#&gt; 75       7     13    0.000    0.360    0.640</span></span>
<span><span class="co">#&gt; 76       7     14    0.005    0.400    0.595</span></span>
<span><span class="co">#&gt; 77       7     15    0.890    0.090    0.020</span></span>
<span><span class="co">#&gt; 78       8      9    0.000    0.280    0.720</span></span>
<span><span class="co">#&gt; 79       8     10    0.945    0.055    0.000</span></span>
<span><span class="co">#&gt; 80       8     11    0.000    0.310    0.690</span></span>
<span><span class="co">#&gt; 81       8     12    0.925    0.065    0.010</span></span>
<span><span class="co">#&gt; 82       8     13    0.015    0.460    0.525</span></span>
<span><span class="co">#&gt; 83       8     14    0.925    0.075    0.000</span></span>
<span><span class="co">#&gt; 84       8     15    0.005    0.445    0.550</span></span>
<span><span class="co">#&gt; 85       9     10    0.000    0.405    0.595</span></span>
<span><span class="co">#&gt; 86       9     11    0.915    0.065    0.020</span></span>
<span><span class="co">#&gt; 87       9     12    0.000    0.320    0.680</span></span>
<span><span class="co">#&gt; 88       9     13    0.810    0.120    0.070</span></span>
<span><span class="co">#&gt; 89       9     14    0.000    0.435    0.565</span></span>
<span><span class="co">#&gt; 90       9     15    0.005    0.380    0.615</span></span>
<span><span class="co">#&gt; 91      10     11    0.005    0.455    0.540</span></span>
<span><span class="co">#&gt; 92      10     12    0.935    0.065    0.000</span></span>
<span><span class="co">#&gt; 93      10     13    0.020    0.380    0.600</span></span>
<span><span class="co">#&gt; 94      10     14    0.000    0.255    0.745</span></span>
<span><span class="co">#&gt; 95      10     15    0.935    0.065    0.000</span></span>
<span><span class="co">#&gt; 96      11     12    0.000    0.425    0.575</span></span>
<span><span class="co">#&gt; 97      11     13    0.000    0.415    0.585</span></span>
<span><span class="co">#&gt; 98      11     14    0.665    0.220    0.115</span></span>
<span><span class="co">#&gt; 99      11     15    0.960    0.030    0.010</span></span>
<span><span class="co">#&gt; 100     12     13    0.960    0.035    0.005</span></span>
<span><span class="co">#&gt; 101     12     14    0.025    0.475    0.500</span></span>
<span><span class="co">#&gt; 102     12     15    0.000    0.425    0.575</span></span>
<span><span class="co">#&gt; 103     13     14    0.910    0.090    0.000</span></span>
<span><span class="co">#&gt; 104     13     15    0.000    0.285    0.715</span></span>
<span><span class="co">#&gt; 105     14     15    0.225    0.460    0.315</span></span></code></pre></div>
<p>It’s often useful to know where the mixture components are location,
so we can get their posterior means using the
<code><a href="../reference/get_component_means.html">get_component_means()</a></code> function for a given number of
components. Here we’ll calculate the posterior means of the components
for the mixture model with 3 components:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_component_means.html">get_component_means</a></span><span class="op">(</span><span class="va">fit_mixture</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;              50%         5%       95%</span></span>
<span><span class="co">#&gt; K = 1 0.09508668 0.03845895 0.1298062</span></span>
<span><span class="co">#&gt; K = 2 0.84673683 0.22354973 0.9533372</span></span>
<span><span class="co">#&gt; K = 3 0.90170414 0.78050683 0.9976114</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-components-in-downstream-analysis">Using components in downstream analysis<a class="anchor" aria-label="anchor" href="#using-components-in-downstream-analysis"></a>
</h2>
<p>Now say that we’re interested in the number of strong vs weak
partners. Specifically we want to know if the strength of connections
only to strong partners predicts a node-level trait. This is a
non-standard analysis so will require some manual data wrangling to fit
the right kind of model.</p>
<p>For demonstration purposes, we’ll create a dataframe that might be
used for this kind of analysis:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_nodal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>node_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">node_1_id</span><span class="op">)</span><span class="op">)</span>, trait<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_nodal</span></span>
<span><span class="co">#&gt;    node_id        trait</span></span>
<span><span class="co">#&gt; 1        1 -0.163956869</span></span>
<span><span class="co">#&gt; 2        2  0.417166376</span></span>
<span><span class="co">#&gt; 3        3 -1.026529143</span></span>
<span><span class="co">#&gt; 4        4  0.154483632</span></span>
<span><span class="co">#&gt; 5        5  0.049465437</span></span>
<span><span class="co">#&gt; 6        6 -0.418917019</span></span>
<span><span class="co">#&gt; 7        7  1.124576040</span></span>
<span><span class="co">#&gt; 8        8 -0.724778621</span></span>
<span><span class="co">#&gt; 9        9  0.106686091</span></span>
<span><span class="co">#&gt; 10      10  0.783754076</span></span>
<span><span class="co">#&gt; 11      11 -0.721932177</span></span>
<span><span class="co">#&gt; 12      12  0.465342170</span></span>
<span><span class="co">#&gt; 13      13  0.057968075</span></span>
<span><span class="co">#&gt; 14      14  0.811572887</span></span>
<span><span class="co">#&gt; 15      15 -0.003290682</span></span></code></pre></div>
<p>This dataframe will provide the information about traits that we need
for the analysis. Next, we need to calculate strength using only
individuals categorised as strong according to the mixture model. Since
both component membership (strong or weak) <em>and</em> edge weights are
probabilistic, we have to sample from both posteriors as we build a new
posterior of mixture-based strength:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set number of nodes and number of posterior samples</span></span>
<span><span class="va">num_nodes</span> <span class="op">&lt;-</span> <span class="va">fit_edge</span><span class="op">$</span><span class="va">num_nodes</span></span>
<span><span class="va">num_draws</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># Keep short for demo purposes.</span></span>
<span></span>
<span><span class="co"># Create a list of igraph networks from edgemodel to represent network posterior</span></span>
<span><span class="va">nets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bison_to_igraph.html">bison_to_igraph</a></span><span class="op">(</span><span class="va">fit_edge</span>, <span class="va">num_draws</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an empty matrix to hold strengths of top mixture component</span></span>
<span><span class="va">mix_strengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_draws</span>, <span class="va">num_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an empty list for imputed versions of the dataframe</span></span>
<span><span class="va">imputed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each posterior sample and calculate strength of top mixture.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_draws</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate edge components (1 if strong, 0 if weak)</span></span>
<span>  <span class="va">edge_components</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="va">fit_mixture</span><span class="op">$</span><span class="va">edge_component_samples</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span>, <span class="op">]</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># If the edge is strong, don't change edge weight, but if it's weak then set to zero.</span></span>
<span>  <span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span> <span class="op">*</span> <span class="va">edge_components</span></span>
<span>  </span>
<span>  <span class="co"># Change the metric values of the imputed data to be mixture-based strength</span></span>
<span>  <span class="va">imputed_data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df_nodal</span></span>
<span>  <span class="va">imputed_data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mix_strength</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/strength.html" class="external-link">strength</a></span><span class="op">(</span><span class="va">nets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">imputed_data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;    node_id        trait mix_strength</span></span>
<span><span class="co">#&gt; 1        1 -0.163956869     5.022821</span></span>
<span><span class="co">#&gt; 2        2  0.417166376     6.020381</span></span>
<span><span class="co">#&gt; 3        3 -1.026529143     5.139991</span></span>
<span><span class="co">#&gt; 4        4  0.154483632     6.716043</span></span>
<span><span class="co">#&gt; 5        5  0.049465437     7.994020</span></span>
<span><span class="co">#&gt; 6        6 -0.418917019     8.381191</span></span>
<span><span class="co">#&gt; 7        7  1.124576040     8.500934</span></span>
<span><span class="co">#&gt; 8        8 -0.724778621     5.236292</span></span>
<span><span class="co">#&gt; 9        9  0.106686091     8.102017</span></span>
<span><span class="co">#&gt; 10      10  0.783754076     6.080982</span></span>
<span><span class="co">#&gt; 11      11 -0.721932177     5.932365</span></span>
<span><span class="co">#&gt; 12      12  0.465342170     6.218257</span></span>
<span><span class="co">#&gt; 13      13  0.057968075     6.985885</span></span>
<span><span class="co">#&gt; 14      14  0.811572887     5.875518</span></span>
<span><span class="co">#&gt; 15      15 -0.003290682     5.162626</span></span></code></pre></div>
<p>Now we have a set of imputed dataframes containing the posteriors of
mixture-based node strength, we can fit the model using
brm_multiple.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_brm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm_multiple.html" class="external-link">brm_multiple</a></span><span class="op">(</span><span class="va">trait</span> <span class="op">~</span> <span class="va">mix_strength</span>, <span class="va">imputed_data</span>, silent<span class="op">=</span><span class="fl">2</span>, refresh<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_brm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The displayed Rhat and ESS estimates should not be trusted for</span></span>
<span><span class="co">#&gt; brm_multiple models. Please see ?brm_multiple for how to assess convergence of</span></span>
<span><span class="co">#&gt; such models.</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: trait ~ mix_strength </span></span>
<span><span class="co">#&gt;    Data: imputed_data (Number of observations: 15) </span></span>
<span><span class="co">#&gt;   Draws: 20 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 20000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept       -1.19      0.98    -3.10     0.77 1.08      162     1000</span></span>
<span><span class="co">#&gt; mix_strength     0.19      0.15    -0.10     0.48 1.08      148      891</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     0.64      0.14     0.42     0.98 1.03      465     3199</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>This was a short tutorial on how to use <code><a href="../reference/bison_mixture.html">bison_mixture()</a></code>
to fit mixture models in bisonR. If you have any questions please get in
touch.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://jordanhart.co.uk/" class="external-link">Jordan Hart</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
